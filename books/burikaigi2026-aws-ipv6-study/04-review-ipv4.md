---
title: "IPv4 についておさらい"
---

IPv4 環境の作成が完了したところで早速 IPv6 対応を！…と行きたいところですが、 IPv4 について、この先の説明を理解するのに必要な範囲でおさらいしておきます。

ただしすべてを説明し始めるとセッションが成立しませんので、一部に絞って説明します。

## IPv4 アドレスの構成

全 32 ビットです。8 ビットずつ「`.`」で区切って十進表記の数字を 4 つ並べます（例：`192.168.0.1`）。

ネットワークを識別する部分である「ネットワーク部」と、ネットワーク内のホストを識別する部分である「ホスト部」に分かれます。ネットワーク部とホスト部を分けるための概念にはクラスフルとクラスレスがあり、現在は基本的にクラスレスが使われます。

クラスレスのアドレス表記では、アドレスの後に「`/`」で区切ってネットワーク部のビット長（プレフィックス長）を記します（CIDR 表記）。

## IPv4 アドレスの種類

ここでは「プライベートアドレス」「グローバルアドレス」といった使い道を切り口にした種類について触れます。

今回のセッションに直接関係のないものについては省略します。

### プライベートアドレス

組織内で自由に割り当てて使うアドレスです。以下のアドレス範囲が使用できます。

- 10.0.0.0/8
- 172.16.0.0/12
- 192.168.0.0/16

インターネットに直接接続できないので、通常は NAT（NAPT）を使ってグローバルアドレスに変換してインターネットアクセスを行います。

### グローバルアドレス

プライベートアドレスやその他の特殊なアドレス範囲を除いたアドレスです。IP アドレスを管理する組織（各 RIR やその配下の組織）から割り当てを受けて使います。

「IPv4 アドレスの現況」で説明しましたが、すでに新規に割り当て可能なアドレス空間はほぼ枯渇しています。

### ループバックアドレス

ホスト自身への通信に使用するアドレスです。`127.0.0.0/8`が割り当てられていますが、通常使うのは`127.0.0.1`がほとんどです。

### リンクローカルアドレス

DHCP などでアドレスが取得できない場合に使うアドレスです。`169.254.0.0/16`の範囲で、APIPA（Automatic Private IP Addressing）で自己割り当てを行う際に使います。

ただし実施にはこのアドレスが使用可能なことはほとんどないので、AWS の VPC では別の用途に利用されています（IMDS や DNS リゾルバのアドレスなど）。

## IPv4 アドレスの割り当て方法

ユーザーが固定的に割り当てる方法と、DHCP(v4) を使う方法があります（他に前述の APIPA がありますがここでは省略）。

DHCP を使うと、IP アドレスだけでなく、サブネット外にアクセスするためのデフォルトゲートウェイや、DNS サーバー（リゾルバ）などのアドレスも DHCP サーバーから取得できます。

## NAT（Network Address Translation：ネットワークアドレス変換）

プライベートアドレスとグローバルアドレスを変換し、プライベートアドレスしか持たないホストからのインターネットアクセスを可能にする技術です。

- プライベートアドレスとグローバルアドレスを「1 : 1」で変換（静的 NAT）
- グローバルアドレスのプールから 1 個選んで変換（動的 NAT）
- ポート番号の変換も利用して「多 : 1」で変換する NAPT（Network Address Port Translation）

があり、AWS ではそれぞれ以下のケースに対応します。

- パブリックサブネットで EC2 に Elastic IP アドレスを割り当てた場合
  - 静的 NAT で固定のグローバルアドレスが割り当てられる
- パブリックサブネットで EC2 に対してパブリック IP アドレスの割り当てを有効にした場合
  - 動的 NAT でグローバルアドレスが割り当てられる
  - EC2 を停止して起動し直すと別のグローバルアドレスが割り当てられる
- プライベートサブネットで NAT ゲートウェイを使う場合
  - NAPT が使われる
